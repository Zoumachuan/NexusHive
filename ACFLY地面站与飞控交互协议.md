**地面站交互协议**

目录

[1.概述](#_Toc184308018)<u>[... ]()</u><u>3</u>

[2.飞控MAVLINK协议格式](#_Toc184308019)<u>[... ]()</u><u>3</u>

[2.1 Mavlink整体结构](#_Toc184308020)<u>[... ]()</u><u>3</u>

[2.2 Mavlink坐标系分类](#_Toc184308021)<u>[... ]()</u><u>5</u>

[2.3 Mavlink校验算法](#_Toc184308022)<u>[... ]()</u><u>6</u>

[2.4 控制无人机](#_Toc184308023)<u>[... ]()</u><u>8</u>

[2.4.1 一键解锁](#_Toc184308024)<u>[... ]()</u><u>9</u>

[2.4.2 一键上锁](#_Toc184308025)<u>[... ]()</u><u>9</u>

[2.4.3 一键起飞](#_Toc184308026)<u>[... ]()</u><u>10</u>

[2.4.4 一键降落](#_Toc184308027)<u>[... ]()</u><u>10</u>

[2.4.5 一键返航](#_Toc184308028)<u>[... ]()</u><u>10</u>

[2.4.6 一键控制载荷](#_Toc184308029)<u>[... ]()</u><u>11</u>

[2.4.7 一键指点飞行](#_Toc184308030)<u>[... ]()</u><u>11</u>

[2.4.8 一键设置飞行模式](#_Toc184308031)<u>[... ]()</u><u>12</u>

[2.4.9 虚拟摇杆控制无人机(需要MAVLINKV2)](#_Toc184308032)<u>[ ]()</u><u>12</u>

[2.4.10 命令反馈](#_Toc184308033)<u>[... ]()</u><u>13</u>

[2.4.11 设置返航点](#_Toc184308034)<u>[... ]()</u><u>14</u>

[2.4.12 飞控串口数据透传报文](#_Toc184308035)<u>[... ]()</u><u>14</u>

[2.4.13 offboard模式控制无人机](#_Toc184308036)<u>[... ]()</u><u>17</u>

[2.5 获取飞机的状态](#_Toc184308037)<u>[... ]()</u><u>19</u>

[2.5.1 更改飞控报文发送频率](#_Toc184308038)<u>[... ]()</u><u>19</u>

[2.5.2 飞机的飞行模式与解锁状态](#_Toc184308039)<u>[... ]()</u><u>20</u>

[2.5.3 飞机的降落状态](#_Toc184308040)<u>[... ]()</u><u>21</u>

[2.5.4 飞机电池电压](#_Toc184308041)<u>[... ]()</u><u>21</u>

[2.5.5 飞机定位信息](#_Toc184308042)<u>[... ]()</u><u>22</u>

[2.5.6 飞机油门百分比](#_Toc184308043)<u>[... ]()</u><u>24</u>

[2.5.7 飞机姿态](#_Toc184308044)<u>[... ]()</u><u>25</u>

[2.5.8 航点任务协议](#_Toc184308045)<u>[... ]()</u><u>25</u>

[3地面站JSON协议](#_Toc184308046)<u>[... ]()</u><u>32</u>

[3.1  JSON状态信息上报](#_Toc184308047)<u>[... ]()</u><u>33</u>

# [1.]()[概述]()

[l  地面站支持MAVLINK协议双向转发。]()

[即把操控端的MAVLINK数据转发给无人机，实现控制无人机的目的。]()

[操控端可以通过解析飞机的MAVLINK消息来获取飞机的状态。]()

[l  地面站支持JSON格式上报无人机状态，但不支持JSON协议控制无人机。]()

[l  协议支持UDP和TCP。]()

[l  多机控制时，每台无人机ID需设置不一样。]()

# [2.]()[飞控MAVLINK协议格式]()

[飞控采用开源的mavlink2.0协议。]()
[飞控默认上电是mavlink1.0协议，需发送MAVLINK2.0心跳包(节2.5.2)给飞控，飞控会自动切换成mavlink2.0。]()
[https://mavlink.io/zh/guide/serialization.html](https://mavlink.io/zh/guide/serialization.html)

## [2.1 Mavlink]()[整体结构]()

[Mavlink1.0]()

| [名称]() | [索引]() | [标识]() | [内容]() | [值]() | [说明]()      |
| -- | -- | -- | -- | -- | ------- |
| [帧头]() | [0]() | [STX]() | [数据帧的起始位置]() | [0xFE]() | [标识新消息的开始]()      |
| [1]() | [LEN]() | [数据包内数据长度n]() | [0-255]() | [标识数据包字节长度]() |       |
| [2]() | [SEQ]() | [数据包序列号]() | [0-255]() | [消息发送序列号，每发送一包数据自动加1，用于检测数据包的丢失]() |       |
| [3]() | [SYS]() | [系统ID]() | [1-255]() | [发送该包的系统ID，能够区分在同一网络中不同的设备。飞控为1，地面站为255]() |       |
| [4]() | [COMP]() | [组件ID]() | [0-255]() | [发送该包的组件ID，能够区分同一设备的不同组件。暂未使用该项，飞控和地面站都设置为0]() |       |
| [5]() | [MSG]() | [消息ID]() | [0-255]() | [该ID定义了数据包的“含义”以及数据包应被如何正确的解码]() |       |
| [数据包]() | [6至6+n]() | [PAYLOAD]() | [数据包内容]() | [0-255 LEN字节]() | [数据包内容]()      |
| [校验]() | [n+7]() | [CKA]() | [校验位（低8位）]() |  | [索引1至索引n+6所有字节，外加CRC\_]()\_[EXTRA，进行CRC-16 /MCRF4XX校验后的校验值]() |
| [n+8]() | [CKB]() | [校验位（高8位）]() |  |  |       |

[Mavlink2.0]()

| [名称]() | [索引]() | [标识]() | [内容]() | [值]() | [说明]()      |
| -- | -- | -- | -- | -- | ------- |
| [帧头]() | [0]() | [STX]() | [数据帧的起始位置]() | [0xFD]() | [标识新消息的开始]()      |
| [1]() | [LEN]() | [数据包内数据长度n]() | [0-255]() | [标识数据包字节长度]() |       |
| [2]() | [FLAGS]() | [兼容性的标志]() | [0]() |  |       |
| [3]() | [FLAGS]() | [兼容性的标志]() | [0]() |  |       |
| [4]() | [SEQ]() | [数据包序列号]() | [0-255]() | [消息发送序列号，每发送一包数据自动加1，用于检测数据包的丢失]() |       |
| [5]() | [SYS]() | [系统ID]() | [1-255]() | [发送该包的系统ID，能够区分在同一网络中不同的设备。飞控出厂默认为1，多台飞机同时接入，需更改此ID来区分，地面站为255]() |       |
| [6]() | [COMP]() | [组件ID]() | [0-255]() | [发送该包的组件ID，能够区分同一设备的不同组件。飞控和地面站都设置为1]() |       |
| [7]() | [MSG]() | [消息ID]() | [0-16777215]() | [该ID定义了数据包的“含义”以及数据包应被如何正确的解码]() |       |
| [数据包]() | [10至10+n]() | [PAYLOAD]() | [载荷]() | [最大255 LEN字节]() | [数据包内容，]()<br />[ 注意：载荷末尾0字节部分做了截断，比如假设最后3个字节都是0，那将不发送此3个字节。]()    |
| [校验]() | [10+n]() | [CKA]() | [校验位（低8位）]() |  | [索引1至索引n+10所有字节，外加CRC\_]()\_[EXTRA，进行CRC-16 /MCRF4XX校验后的校验值]() |
| [11+n]() | [CKB]() | [校验位（高8位）]() |  |  |       |

[注：]()

[（1）所有的多字节字段均为小端序。]()

[（2）下文数据类型，按C语言头文件&lt;]()\<[stdint.h&gt;]()\>[定义一致：如int8\_]()\_[t代表有符号单字节、 uint16\_]()\_[t代表无符号两字节。]()

[（3）字节对齐方式：1字节对齐。]()

[（4）mavlinkV2帧的起始标记为0xFD,mavlinkV1帧的起始标记为0xFE。]()

[（5）PAYLOAD载荷就是下面各种报文（ID区分）的内容。]()

[（6）mavlinkV2 的msgid 字段占3个字节，小端序。]()

[（7）mavlinkV2对载荷末尾0字节部分做了截断，而V1版本不做此处理。（8）CRC\_]()\_[EXTRA属于额外校验字节，每个报文不一样。]()

[（9）某些报文MavlinkV2发送的PAYLOAD会比MAVLINK1多(拓展)，例如报文147、69等。]()

## [2.2 Mavlink]()[坐标系分类]()

| [类型]()                          | [数值]() | [说明]()       |
| --------------------------- | -- | -------- |
| [MAV\_]()\_[FRAME\_]()\_[GLOBAL]()                | [0]() | [Global (WGS84)+海拔高 经纬度表示为小数格式]()       |
| [MAV\_]()\_[FRAME\_]()\_[LOCAL\_]()\_[NED]()           | [1]() | [NED坐标系，原点在起飞点]()       |
| [MAV\_]()\_[FRAME\_]()\_[MISSION]()                | [2]() | [任务航线/命令时的坐标系]()       |
| [MAV\_]()\_[FRAME\_]()\_[GLOBAL\_]()\_[RELATIVE\_]()\_[ALT]()      | [3]() | [Global (WGS84)+相对起飞点高]()<br />[ 经纬度表示为小数格式]()     |
| [MAV\_]()\_[FRAME\_]()\_[LOCAL\_]()\_[ENU]()           | [4]() | [ENU坐标系]()       |
| [MAV\_]()\_[FRAME\_]()\_[GLOBAL\_]()\_[INT]()           | [5]() | [Global (WGS84)+海拔高]()<br />[ 经纬度表示为1e7整数格式]()     |
| [MAV\_]()\_[FRAME\_]()\_[GLOBAL\_]()\_[RELATIVE\_]()\_[ALT\_]()\_[INT]() | [6]() | [Global (WGS84)+相对起飞点高]()<br />[ 经纬度表示为1e7整数格式]()     |
| [MAV\_]()\_[FRAME\_]()\_[LOCAL\_]()\_[OFFSET\_]()\_[NED]()      | [7]() | [NED坐标系，原点跟随飞机移动]()       |
| [MAV\_]()\_[FRAME\_]()\_[BODY\_]()\_[NED]()           | [8]() | [和1号坐标系一样]()       |
| [MAV\_]()\_[FRAME\_]()\_[BODY\_]()\_[OFFSET\_]()\_[NED]()      | [9]() | [和12号坐标系一样]()       |
| [MAV\_]()\_[FRAME\_]()\_[GLOBAL\_]()\_[TERRAIN\_]()\_[ALT]()      | [10]() | [Global (WGS84)+相对地形高]()<br />[ 经纬度表示为小数格式]()     |
| [MAV\_]()\_[FRAME\_]()\_[GLOBAL\_]()\_[TERRAIN\_]()\_[ALT\_]()\_[INT]() | [11]() | [Global (WGS84)+相对地形高]()<br />[ 经纬度表示为1e7整数格式]()     |
| [MAV\_]()\_[FRAME\_]()\_[BODY\_]()\_[FRD]()           | [12]() | [机体坐标系]()<br />[ 前X正]()<br />[ 右Y正]()<br />[ 下Z正]() |
| [MAV\_]()\_[FRAME\_]()\_[BODY\_]()\_[FLU]()           | [13]() | [机体坐标系]()<br />[ 前X正]()<br />[ 左Y正]()<br />[ 上Z正]() |

## [2.3 Mavlink]()[校验算法]()

[uint16\_]()\_[t checksum\=]()\=[ 0xffff;]()

[For(int i\=]()\=[0; i&lt;]()\<[len;i++){]()

[crc\_]()\_[accumulate (buffer[i], &amp;checksum);]()

[}]()

[crc\_]()\_[accumulate (CRC\_]()\_[EXTRA, &amp;checksum);]()

[void crc\_]()\_[accumulate(uint8\_]()\_[t data, uint16\_]()\_[t \*]()\*[crcAccum)]()

[{]()

[   uint8\_]()\_[t tmp;]()

[   tmp \=]()\=[ data \^]()\^[ (uint8\_]()\_[t)(\*]()\*[crcAccum &amp;0xff);]()

[   tmp \^]()\^[\=]()\=[ (tmp&lt;]()\<[&lt;]()\<[4);]()

[   \*]()\*[crcAccum \=]()\=[ (\*]()\*[crcAccum&gt;]()\>[&gt;]()\>[8) \^]()\^[ (tmp&lt;]()\<[&lt;]()\<[8) \^]()\^[ (tmp &lt;]()\<[&lt;]()\<[3) \^]()\^[ (tmp&gt;]()\>[&gt;]()\>[4);]()

[}]()

[如上，校验需最后包含一个额外校验字节CRC\_]()\_[EXTRA，校验算法: CRC-16/MCRF4XX，C/C++具体算法请看文件MAVLINK校验算法.txt]()

| [报文ID]() | [CRC\_]()\_[EXTRA]() | [说明]()                     |
| -- | ------- | ---------------------- |
| [0]() | [50]()      | [HEART\_]()\_[BEAT]()                |
| [1]() | [124]()      | [SYS\_]()\_[STATUS]()                |
| [20]() | [214]()      | [PARAM\_]()\_[REQUEST\_]()\_[READ]()           |
| [22]() | [220]()      | [PARAM\_]()\_[REQUEST\_]()\_[LIST]()           |
| [23]() | [168]()      | [PARAM\_]()\_[SET]()                |
| [24]() | [24]()      | [GPS\_]()\_[RAW\_]()\_[INT]()           |
| [26]() | [170]()      | [SCALED\_]()\_[IMU]()                |
| [30]() | [39]()      | [ATTITUDE]()                     |
| [32]() | [185]()      | [LOCAL\_]()\_[POSITION\_]()\_[NED]()           |
| [33]() | [104]()      | [GLOBAL\_]()\_[POSITION\_]()\_[INT]()           |
| [34]() | [237]()      | [RC\_]()\_[CHANNELS\_]()\_[SCALED]()           |
| [35]() | [244]()      | [RC\_]()\_[CHANNELS\_]()\_[RAW]()           |
| [39]() | [254]()      | [MISSION\_]()\_[ITEM]()                |
| [40]() | [230]()      | [MISSION\_]()\_[REQUEST]()                |
| [41]() | [132]()      | [MISSION\_]()\_[SET\_]()\_[CURRENT]()           |
| [42]() | [28]()      | [MISSION\_]()\_[CURRENT]()                |
| [43]() | [132]()      | [MISSION\_]()\_[REQUEST\_]()\_[LIST]()           |
| [44]() | [221]()      | [MISSION\_]()\_[COUNT]()                |
| [45]() | [232]()      | [MISSION\_]()\_[CLEAR\_]()\_[ALL]()           |
| [47]() | [153]()      | [MISSION\_]()\_[ACK]()                |
| [51]() | [196]()      | [MISSION\_]()\_[REQUEST\_]()\_[INT]()           |
| [65]() | [118]()      | [RC\_]()\_[CHANNELS]()                |
| [66]() | [148]()      | [REQUEST\_]()\_[DATA\_]()\_[STREAM]()           |
| [69]() | [243]()      | [MANUAL\_]()\_[CONTROL]()                |
| [73]() | [38]()      | [MISSION\_]()\_[ITEM\_]()\_[INT]()           |
| [74]() | [20]()      | [VFR\_]()\_[HUD]()                |
| [75]() | [158]()      | [COMMAND\_]()\_[INT]()                |
| [76]() | [152]()      | [COMMAND\_]()\_[LONG]()                |
| [77]() | [143]()      | [COMMAND\_]()\_[ACK]()                |
| [84]() | [143]()      | [SET\_]()\_[POSITION\_]()\_[TARGET\_]()\_[LOCAL\_]()\_[NED]() |
| [86]() | [5]()      | [SET\_]()\_[POSITION\_]()\_[TARGET\_]()\_[GLOBAL\_]()\_[INT]() |
| [124]() | [87]()      | [GPS2\_]()\_[RAW]()                |
| [147]() | [154]()      | [BATTERY\_]()\_[STATUS]()                |
| [245]() | [130]()      | [EXTENDED\_]()\_[SYS\_]()\_[STATE]()           |
| [243]() | [85]()      | [SET\_]()\_[HOME\_]()\_[POSITION]()           |
| [170]() | [73]()      | [DATA32]()                     |
| [171]() | [181]()      | [DATA64]()                     |
| [172]() | [22]()      | [DATA96]()                     |

## [2.4 ]()[控制无人机]()

| [报文]()[MSG\_]()\_[ID\_]()\_[COMMAND\_]()\_[LONG，ID\=]()\=[76]() | [载荷长度: 33 数据流向：操控端-&gt;]()\>[飞机]() |
| ---------------------- | ------- |
| [简写]()                     | [类型]()      |
| [param1]()                     | [float]()      |
| [param2]()                     | [float]()      |
| [param3]()                     | [float]()      |
| [param4]()                     | [float]()      |
| [param5]()                     | [float]()      |
| [param6]()                     | [float]()      |
| [param7]()                     | [float]()      |
| [command]()                     | [uint16\_]()\_[t]() |
| [target\_]()\_[system]()                | [uint8\_]()\_[t]() |
| [target\_]()\_[component]()                | [uint8\_]()\_[t]() |
| [confirmation]()                     | [uint8\_]()\_[t]() |

| [报文MSG\_]()\_[ID\_]()\_[COMMAND\_]()\_[INT，ID\=]()\=[75]() | [载荷长度: 35，数据流向：操控端-&gt;]()\>[飞机]() |
| ---------------------- | ------- |
| [简写]()                     | [类型]()      |
| [param1]()                     | [float]()      |
| [param2]()                     | [float]()      |
| [param3]()                     | [float]()      |
| [param4]()                     | [float]()      |
| [x]()                     | [int32\_]()\_[t]() |
| [y]()                     | [int32\_]()\_[t]() |
| [z]()                     | [float]()      |
| [command]()                     | [uint16\_]()\_[t]() |
| [target\_]()\_[system]()                | [uint8\_]()\_[t]() |
| [target\_]()\_[component]()                | [uint8\_]()\_[t]() |
| [frame]()                     | [uint8\_]()\_[t]() |
| [current]()                     | [uint8\_]()\_[t]() |
| [autocontinue]()                     | [uint8\_]()\_[t]() |

### [2.4.1 ]()[一键解锁]()

| [报文MSG\_]()\_[ID\_]()\_[COMMAND\_]()\_[LONG，ID\=]()\=[76]() | [参数说明]()                                         |
| ---------------------- | ------------------------------------------ |
| [一键解锁]()                     | [param1 \=]()\=[ 1 ; param2 \=]()\=[ 0 ; param3 \=]()\=[ 0 ; param4 \=]()\=[ 0 ; param5 \=]()\=[ 0 ; param6 \=]()\=[ 0 ; param7 \=]()\=[ 0 ; command \=]()\=[ 400 ;]() |

### [2.4.2 ]()[一键上锁]()

| [报文MSG\_]()\_[ID\_]()\_[COMMAND\_]()\_[LONG，ID\=]()\=[76]() | [参数说明]()                                         |
| ---------------------- | ------------------------------------------ |
| [一键上锁]()                     | [param1 \=]()\=[ 0 ; param2 \=]()\=[ 0 ; param3 \=]()\=[ 0 ; param4 \=]()\=[ 0 ; param5 \=]()\=[ 0 ; param6 \=]()\=[ 0 ; param7 \=]()\=[ 0 ; command \=]()\=[ 400 ;]() |

### [2.4.3 ]()[一键起飞]()

| [报文MSG\_]()\_[ID\_]()\_[COMMAND\_]()\_[LONG，ID\=]()\=[76]() | [参数说明]()                                    |
| ---------------------- | ------------------------------------- |
| [一键起飞]()                     | [param1 \=]()\=[ 0 ; param2 \=]()\=[ 0 ; param3 \=]()\=[ 0 ; param4 \=]()\=[ 0 ; param5 \=]()\=[ 0 ; param6 \=]()\=[ 0; param7 ;（起飞高度，单位m） command \=]()\=[ 24]() |

### [2.4.4 ]()[一键降落]()

| [报文MSG\_]()\_[ID\_]()\_[COMMAND\_]()\_[LONG，ID\=]()\=[76]() | [参数说明]()                                    |
| ---------------------- | ------------------------------------- |
| [一键降落]()                     | [param1 \=]()\=[ 0 ; param2 \=]()\=[ 0 ; param3 \=]()\=[ 0 ; param4 \=]()\=[ Yaw Angle ;（飞机航向，单位度） param5 \=]()\=[ 1000 ; param6 \=]()\=[ 1000; param7;（降落海拔高度，单位m） command \=]()\=[ 21]() |

### [2.4.5 ]()[一键返航]()

| [报文MSG\_]()\_[ID\_]()\_[COMMAND\_]()\_[LONG，ID\=]()\=[76]() | [参数说明]()                                         |
| ---------------------- | ------------------------------------------ |
| [一键返航]()                     | [param1 \=]()\=[ 0 ; param2 \=]()\=[ 0 ; param3 \=]()\=[ 0 ; param4 \=]()\=[ 0; param5 \=]()\=[ 0; param6 \=]()\=[ 0; param7 \=]()\=[ 0; command \=]()\=[ 20]() |

### [2.4.6 ]()[一键控制载荷]()

| [报文MSG\_]()\_[ID\_]()\_[COMMAND\_]()\_[LONG，ID\=]()\=[76]() | [参数说明]()                                         |
| ---------------------- | ------------------------------------------ |
| [一键指点飞行]()                     | [param1 \=]()\=[ PWM通道;  [1，14] param2 \=]()\=[ PWM占空比; [0，65000]，50HZ param3 \=]()\=[ 0 ; param4 \=]()\=[ 0 ; param5 \=]()\=[ 0 ; param6 \=]()\=[ 0 ; param7 \=]()\=[ 0 ; command \=]()\=[ 183]() |

### [2.4.7 ]()[一键指点飞行]()

| [报文MSG\_]()\_[ID\_]()\_[COMMAND\_]()\_[INT，ID\=]()\=[75]() | [参数说明]()                                              |
| ---------------------- | ----------------------------------------------- |
| [一键指点飞行]()                     | [param1 ; （速度，m/s） param2 \=]()\=[ MAV\_]()\_[DO\_]()\_[REPOSITION\_]()\_[FLAGS\_]()\_[CHANGE\_]()\_[MODE (1);  param3 \=]()\=[ 0 ; param4;（航向角，-360 \~]()\~[360，填nan则指向航点再飞过去， 填1000则不旋转偏航） param5;（纬度，例：211234567） param6;（纬度，例1131234567） param7;（海拔高度，单位米） command \=]()\=[ 192]() |

### [2.4.8 ]()[一键设置飞行模式]()

| [报文MSG\_]()\_[ID\_]()\_[COMMAND\_]()\_[LON，ID\=]()\=[76]() | [参数说明]()                                         |
| ---------------------- | ------------------------------------------ |
| [一键设置飞行模式]()                     | [param1 \=]()\=[ 1; param2 \=]()\=[ CustomMode； param3 \=]()\=[ CustomSubmode ; CustomMode代表飞机的主模式，定义如下 l 定高模式（2） l 定点模式（3） l 自动模式（4） l Offboard模式（6） CustomSubmode代表飞机细分模式，定义如下 自动模式细分： l 自动起飞模式（2）(不可设置，只反馈) l 自动跟踪模式（3） l 自动任务模式（4） l 自动返航模式（5） l 自动降落模式（6） 定点模式细分： l 普通定点模式（0） l 定点避障模式（2） param4 \=]()\=[ 0; param5 \=]()\=[ 0; param6 \=]()\=[ 0; param7 \=]()\=[ 0; command \=]()\=[ 176]() |

### [2.4.9 ]()[虚拟摇杆控制无人机(需要MAVLINKV2)]()

| [报文MAVLINK\_]()\_[MSG\_]()\_[ID\_]()\_[MANUAL\_]()\_[CONTROL，]()<br />[ID\=]()\=[69，报文周期10HZ]() | [载荷长度: ]()<br />[MAVLINK2: 26，]()<br />[ MAVLINK1: 10 数据流向：飞机-&gt;]()\>[操控端]() |
| ----------------------------- | ----------- |
| [简写]()                            | [类型]()          |
| [x]()                            | [int16\_]()\_[t]()     |
| [y]()                            | [int16\_]()\_[t]()     |
| [z]()                            | [int16\_]()\_[t]()     |
| [r]()                            | [int16\_]()\_[t]()     |
| [buttons]()                            | [uint16\_]()\_[t]()     |
| [target]()                            | [uint8\_]()\_[t]()     |
| [buttons2]()                            | [uint16\_]()\_[t]()     |
| [enabled\_]()\_[extensions]()                       | [uint8\_]()\_[t]()     |
| [s]()                            | [int16\_]()\_[t]()     |
| [t]()                            | [int16\_]()\_[t]()     |
| [extendedAxis1]()                            | [int16\_]()\_[t]()     |
| [extendedAxis2]()                            | [int16\_]()\_[t]()     |
| [extendedAxis3]()                            | [int16\_]()\_[t]()     |
| [extendedAxis4]()                            | [int16\_]()\_[t]()     |

[注：黄色部分只有MAVLINK2会发送。]()

### [2.4.10 ]()[命令反馈]()

[周期性命令，飞机不会反馈ACK。]()

| [报文MAVLINK\_]()\_[MSG\_]()\_[ID\_]()\_[COMMAND\_]()\_[ACK，]()<br />[ID\=]()\=[77]() | [载荷长度: 10，数据流向：飞机 -&gt;]()\>[ 操控端]() |
| ----------------------------- | ------- |
| [简写]()                            | [类型]()      |
| [command]()                            | [uint16\_]()\_[t]() |
| [result]()                            | [uint8\_]()\_[t]() |
| [progress]()                            | [uint8\_]()\_[t]() |
| [result\_]()\_[param2]()                       | [int32\_]()\_[t]() |
| [target\_]()\_[system]()                       | [uint8\_]()\_[t]() |
| [target\_]()\_[component]()                       | [uint8\_]()\_[t]() |

### [2.4.11 ]()[设置返航点]()

| [报文]()<br />[ MAVLINK\_]()\_[MSG\_]()\_[ID\_]()\_[SET\_]()\_[HOME\_]()\_[POSITION，]()<br />[ID\=]()\=[243]() | [载荷长度: 61，数据流向：操控端-&gt;]()\>[飞机]() |
| ------------------------------------ | ------- |
| [简写]()                                   | [类型]()      |
| [latitude]()                                   | [int32\_]()\_[t]() |
| [longitude]()                                   | [int32\_]()\_[t]() |
| [altitude]()                                   | [int32\_]()\_[t]() |
| [x]()                                   | [float]()      |
| [y]()                                   | [float]()      |
| [z]()                                   | [float]()      |
| [q[4]]()                                   | [float]()      |
| [approach\_]()\_[x]()                              | [float]()      |
| [approach\_]()\_[y]()                              | [float]()      |
| [approach\_]()\_[z]()                              | [float]()      |
| [target\_]()\_[system]()                              | [uint8\_]()\_[t]() |
| [time\_]()\_[usec]()                              | [uint64\_]()\_[t]() |

### [2.4.12 ]()[飞控串口数据透传报文]()

| [报文]()<br />[ MAVLINK\_]()\_[MSG\_]()\_[ID\_]()\_[DATA32，]()<br />[ID\=]()\=[170]() | [载荷长度: 34，数据流向：双向]()      |
| -------------------------- | ------- |
| [简写]()                         | [类型]()      |
| [type]()                         | [uint8\_]()\_[t]() |
| [len]()                         | [uint8\_]()\_[t]() |
| [data[32]]()                         | [uint8\_]()\_[t]() |

| [报文]()<br />[ MAVLINK\_]()\_[MSG\_]()\_[ID\_]()\_[DATA64，]()<br />[ID\=]()\=[171]() | [载荷长度: 66，数据流向：双向]()      |
| -------------------------- | ------- |
| [简写]()                         | [类型]()      |
| [type]()                         | [uint8\_]()\_[t]() |
| [len]()                         | [uint8\_]()\_[t]() |
| [data[64]]()                         | [uint8\_]()\_[t]() |

| [报文]()<br />[ MAVLINK\_]()\_[MSG\_]()\_[ID\_]()\_[DATA96，]()<br />[ID\=]()\=[172]() | [载荷长度: 98，数据流向：双向]()      |
| -------------------------- | ------- |
| [简写]()                         | [类型]()      |
| [type]()                         | [uint8\_]()\_[t]() |
| [len]()                         | [uint8\_]()\_[t]() |
| [data[96]]()                         | [uint8\_]()\_[t]() |

### [2.4.13 offboard]()[模式控制无人机]()

| [报文 MAVLINK\_]()\_[MSG\_]()\_[ID\_]()\_[SET\_]()\_[POSITION\_]()\_[TARGET\_]()\_[LOCAL\_]()\_[NED，]()<br />[ID\=]()\=[84]() | [载荷长度: 53 数据流向：板载计算机-&gt;]()\>[飞控]() |
| -------------------------------------------- | ------- |
| [简写]()                                           | [类型]()      |
| [time\_]()\_[boot\_]()\_[ms]()                                 | [uint32\_]()\_[t]() |
| [x]()                                           | [float]()      |
| [y]()                                           | [float]()      |
| [z]()                                           | [float]()      |
| [vx]()                                           | [float]()      |
| [vy]()                                           | [float]()      |
| [vz]()                                           | [float]()      |
| [afx]()                                           | [float]()      |
| [afy]()                                           | [float]()      |
| [afz]()                                           | [float]()      |
| [yaw]()                                           | [float]()      |
| [yaw\_]()\_[rate]()                                      | [float]()      |
| [type\_]()\_[mask]()                                      | [uint16\_]()\_[t]() |
| [target\_]()\_[system]()                                      | [uint8\_]()\_[t]() |
| [target\_]()\_[component]()                                      | [uint8\_]()\_[t]() |
| [coordinate\_]()\_[frame]()                                      | [uint8\_]()\_[t]() |

| [报文 MAVLINK\_]()\_[MSG\_]()\_[ID\_]()\_[SET\_]()\_[POSITION\_]()\_[TARGET\_]()\_[GLOBAL\_]()\_[INT，]()<br />[ID\=]()\=[86]() | [载荷长度: 53 数据流向：板载计算机-&gt;]()\>[飞控]() |
| -------------------------------------------- | ------- |
| [简写]()                                           | [类型]()      |
| [time\_]()\_[boot\_]()\_[ms]()                                 | [uint32\_]()\_[t]() |
| [lat\_]()\_[int]()                                      | [int32\_]()\_[t]() |
| [lon\_]()\_[int]()                                      | [int32\_]()\_[t]() |
| [alt]()                                           | [float]()      |
| [vx]()                                           | [float]()      |
| [vy]()                                           | [float]()      |
| [vz]()                                           | [float]()      |
| [afx]()                                           | [float]()      |
| [afy]()                                           | [float]()      |
| [afz]()                                           | [float]()      |
| [yaw]()                                           | [float]()      |
| [yaw\_]()\_[rate]()                                      | [float]()      |
| [type\_]()\_[mask]()                                      | [uint16\_]()\_[t]() |
| [target\_]()\_[system]()                                      | [uint8\_]()\_[t]() |
| [target\_]()\_[component]()                                      | [uint8\_]()\_[t]() |
| [coordinate\_]()\_[frame]()                                      | [uint8\_]()\_[t]() |

## [2.5 ]()[获取飞机的状态]()

[所有报文由飞机主动发送，可更改频率。]()

### [2.5.1 ]()[更改飞控报文发送频率]()

| [报文]()<br />[ MAVLINK\_]()\_[MSG\_]()\_[ID\_]()\_[REQUEST\_]()\_[DATA\_]()\_[STREAM，]()<br />[ID\=]()\=[66]() | [载荷长度: 6，数据流向：操控端-&gt;]()\>[飞机]() |
| ------------------------------------ | ------- |
| [简写]()                                   | [类型]()      |
| [req\_]()\_[message\_]()\_[rate]()                         | [uint16\_]()\_[t]() |
| [target\_]()\_[system]()                              | [uint8\_]()\_[t]() |
| [target\_]()\_[component]()                              | [uint8\_]()\_[t]() |
| [req\_]()\_[stream\_]()\_[id]()                         | [uint8\_]()\_[t]() |
| [start\_]()\_[stop]()                              | [uint8\_]()\_[t]() |

### [2.5.2 ]()[飞机的飞行模式与解锁状态]()

| [报文MSG\_]()\_[ID\_]()\_[HEARTBEAT，ID\=]()\=[0，1HZ]() | [载荷长度: 9，数据流向：飞机-&gt;]()\>[操控端]() |
| ----------------- | ------- |
| [简写]()                | [类型]()      |
| [custom\_]()\_[mode]()           | [uint32\_]()\_[t]() |
| [type]()                | [uint8\_]()\_[t]() |
| [autopilot]()                | [uint8\_]()\_[t]() |
| [base\_]()\_[mode]()           | [uint8\_]()\_[t]() |
| [system\_]()\_[status]()           | [uint8\_]()\_[t]() |
| [mavlink\_]()\_[version]()           | [uint8\_]()\_[t]() |

| [字段]()      | [说明]()                          |
| ------- | --------------------------- |
| [custom\_]()\_[mode]() | [custom\_]()\_[mode的第3个字节代表飞机的主模式，定义如下 定高模式（2） 定点模式（3） 自动模式（4） custom\_]()\_[mode的第4个字节代表飞机的细分模式，定义如下 自动模式细分： l 自动起飞模式（2） l 自动跟踪模式（3） l 自动任务模式（4） l 自动返航模式（5） l 自动降落模式（6） 定点模式细分： l 普通定点模式（0） l 定点避障模式（2）]()                |
| [base\_]()\_[mode]() | [(base\_]()\_[mode&amp;0x80) \=]()\=[\=]()\=[0x80 飞机已解锁， (base\_]()\_[mode&amp;0x80) !\=]()\=[0x80 飞机未解锁.]() |

### [2.5.3 ]()[飞机的降落状态]()

| [消息MAVLINK\_]()\_[MSG\_]()\_[ID\_]()\_[EXTENDED\_]()\_[SYS\_]()\_[STATE]()<br />[ ，ID\=]()\=[245，1HZ]() | [载荷长度: 2，数据流向：飞机-&gt;]()\>[操控端]() |
| ---------------------------------- | ------- |
| [简写]()                                 | [类型]()      |
| [vtol\_]()\_[state]()                            | [uint8\_]()\_[t]() |
| [landed\_]()\_[state]()                            | [uint8\_]()\_[t]() |
|                                  |       |

| [字段]()      | [说明]()                                         |
| ------- | ------------------------------------------ |
| [landed\_]()\_[state]() | [MAV\_]()\_[LANDED\_]()\_[STATE\_]()\_[IN\_]()\_[AIR（2） 飞机飞行中 MAV\_]()\_[LANDED\_]()\_[STATE\_]()\_[ON\_]()\_[GROUND（1）飞机在地面]() |

### [2.5.4 ]()[飞机电池电压]()

| [报文MAVLINK\_]()\_[MSG\_]()\_[ID\_]()\_[BATTERY\_]()\_[STATUS]()<br />[ ，ID\=]()\=[147，1HZ]() | [载荷长度: ]()<br />[MAVLINK2: 54，]()<br />[ MAVLINK1: 36 数据流向：飞机-&gt;]()\>[操控端]() |
| ----------------------------- | ----------- |
| [简写]()                            | [类型]()          |
| [current\_]()\_[consumed]()                       | [int32\_]()\_[t]()     |
| [energy\_]()\_[consumed]()                       | [int32\_]()\_[t]()     |
| [temperature]()                            | [Int16\_]()\_[t]()     |
| [voltages[10]]()                            | [uint16\_]()\_[t]()     |
| [current\_]()\_[battery]()                       | [int16\_]()\_[t]()     |
| [id]()                            | [uint8\_]()\_[t]()     |
| [battery\_]()\_[funct]()                       | [uint8\_]()\_[t]()     |
| [type]()                            | [uint8\_]()\_[t]()     |
| [battery\_]()\_[remaining]()                       | [int8\_]()\_[t]()     |
| [time\_]()\_[remaining]()                       | [int32\_]()\_[t]()     |
| [charge\_]()\_[state]()                       | [uint8\_]()\_[t]()     |
| [voltages\_]()\_[ext[4]]()                       | [uint16\_]()\_[t]()     |
| [mode]()                            | [uint8\_]()\_[t]()     |
| [fault\_]()\_[bitmask]()                       | [uint32\_]()\_[t]()     |

[注：黄色部分只有MAVLINK2会发送。]()
[if(voltages[1] \=]()\=[\=]()\=[ 65535 &amp;&amp; voltages[2] \=]()\=[\=]()\=[ 65535){]()

[电池电压(V) \=]()\=[ \*]()\*[((uint32\_]()\_[t\*]()\*[)&amp;(voltages[4])) / 1000.0;]()

[电池总容量(mAh)\=]()\=[ \*]()\*[((uint32\_]()\_[t\*]()\*[)&amp;(voltages[6]));]()

[电池循环次数 \=]()\=[ voltages[8];]()

[    电池电流(A) \=]()\=[ current\_]()\_[battery /100.0;]()

[剩余百分比 \=]()\=[ battery\_]()\_[remaining;]()

[}]()

[else]()

[{//智能电池，电压等于单节电压总和.]()

[       for (int i\=]()\=[0; i&lt;]()\<[10; i++) {]()

[              电池电压(V) +\=]()\=[ voltages[i];]()

[}]()

[for (int i\=]()\=[0; i&lt;]()\<[4; i++) {]()

[              电池电压(V) +\=]()\=[ voltages\_]()\_[ext [i];]()

[}]()

[电池循环次数 \=]()\=[ battery\_]()\_[ function;]()

[电池总容量(mAh) \=]()\=[ energy\_]()\_[consumed；]()

[电池电流(A) \=]()\=[ current\_]()\_[battery /100.0;]()

[剩余百分比 \=]()\=[ battery\_]()\_[remaining;]()

[消耗电量(mAh) \=]()\=[ current\_]()\_[consumed；]()

[}]()

### [2.5.5 ]()[飞机定位信息]()

| [报文MAVLINK\_]()\_[MSG\_]()\_[ID\_]()\_[GLOBAL\_]()\_[POSITION\_]()\_[INT]()<br />[ ，ID\=]()\=[33，2HZ]() | [载荷长度: 28，数据流向：飞机-&gt;]()\>[操控端]() |
| ---------------------------------- | ------- |
| [简写]()                                 | [类型]()      |
| [time\_]()\_[boot\_]()\_[ms]()                       | [uint32\_]()\_[t]() |
| [lat]()                                 | [int32\_]()\_[t]() |
| [lon]()                                 | [int32\_]()\_[t]() |
| [alt]()                                 | [int32\_]()\_[t]() |
| [relative\_]()\_[alt]()                            | [int32\_]()\_[t]() |
| [vx]()                                 | [int16\_]()\_[t]() |
| [vy]()                                 | [int16\_]()\_[t]() |
| [vz]()                                 | [int16\_]()\_[t]() |
| [hdg]()                                 | [uint16\_]()\_[t]() |

| [报文MAVLINK\_]()\_[MSG\_]()\_[ID\_]()\_[GPS\_]()\_[RAW\_]()\_[INT]()<br />[ ，ID\=]()\=[24，2HZ，北斗1原始位置]() | [载荷长度: 52，数据流向：飞机-&gt;]()\>[操控端]() |
| ---------------------------------- | ------- |
| [简写]()                                 | [类型]()      |
| [time\_]()\_[boot\_]()\_[ms]()                       | [uint64\_]()\_[t]() |
| [lat]()                                 | [int32\_]()\_[t]() |
| [lon]()                                 | [int32\_]()\_[t]() |
| [alt]()                                 | [int32\_]()\_[t]() |
| [eph]()                                 | [uint16\_]()\_[t]() |
| [epv]()                                 | [uint16\_]()\_[t]() |
| [vel]()                                 | [uint16\_]()\_[t]() |
| [cog]()                                 | [int16\_]()\_[t]() |
| [fix\_]()\_[type]()                            | [uint8\_]()\_[t]() |
| [satellites\_]()\_[visible]()                            | [uint8\_]()\_[t]() |
| [alt\_]()\_[ellipsoid]()                            | [int32\_]()\_[t]() |
| [h\_]()\_[acc]()                            | [uint32\_]()\_[t]() |
| [v\_]()\_[acc]()                            | [uint32\_]()\_[t]() |
| [vel\_]()\_[acc]()                            | [uint32\_]()\_[t]() |
| [hdg\_]()\_[acc]()                            | [uint32\_]()\_[t]() |
| [yaw]()                                 | [uint16\_]()\_[t]() |

| [报文MAVLINK\_]()\_[MSG\_]()\_[ID\_]()\_[GPS2\_]()\_[RAW]()<br />[ ，ID\=]()\=[124，2HZ，北斗2原始位置]() | [载荷长度: 57，数据流向：飞机-&gt;]()\>[操控端]() |
| ----------------------------- | ------- |
| [简写]()                            | [类型]()      |
| [time\_]()\_[boot\_]()\_[ms]()                  | [uint64\_]()\_[t]() |
| [lat]()                            | [int32\_]()\_[t]() |
| [lon]()                            | [int32\_]()\_[t]() |
| [alt]()                            | [int32\_]()\_[t]() |
| [dgps\_]()\_[age]()                       | [uint32\_]()\_[t]() |
| [eph]()                            | [uint16\_]()\_[t]() |
| [epv]()                            | [uint16\_]()\_[t]() |
| [vel]()                            | [uint16\_]()\_[t]() |
| [cog]()                            | [int16\_]()\_[t]() |
| [fix\_]()\_[type]()                       | [uint8\_]()\_[t]() |
| [satellites\_]()\_[visible]()                       | [uint8\_]()\_[t]() |
| [dgps\_]()\_[numch]()                       | [uint8\_]()\_[t]() |
| [yaw]()                            | [uint16\_]()\_[t]() |
| [alt\_]()\_[ellipsoid]()                       | [int32\_]()\_[t]() |
| [h\_]()\_[acc]()                       | [uint32\_]()\_[t]() |
| [v\_]()\_[acc]()                       | [uint32\_]()\_[t]() |
| [vel\_]()\_[acc]()                       | [uint32\_]()\_[t]() |
| [hdg\_]()\_[acc]()                       | [uint32\_]()\_[t]() |

### [2.5.6 ]()[飞机油门百分比]()

| [报文MAVLINK\_]()\_[MSG\_]()\_[ID\_]()\_[VFR\_]()\_[HUD]()<br />[ ，ID\=]()\=[74，2HZ]() | [载荷长度: 20，数据流向：飞机-&gt;]()\>[操控端]() |
| ----------------------------- | ------- |
| [简写]()                            | [类型]()      |
| [airspeed]()                            | [float]()      |
| [groundspeed]()                            | [float]()      |
| [alt]()                            | [float]()      |
| [climb]()                            | [float]()      |
| [heading]()                            | [int16\_]()\_[t]() |
| [throttle]()                            | [uint16\_]()\_[t]() |

### [2.5.7 ]()[飞机姿态]()

| [消息MAVLINK\_]()\_[MSG\_]()\_[ID\_]()\_[ATTITUDE]()<br />[ ，ID\=]()\=[30，10HZ]() | [载荷长度: 28，数据流向：地面站-&gt;]()\>[操控端]() |
| ------------------------ | ------- |
| [简写]()                       | [类型]()      |
| [time\_]()\_[boot\_]()\_[ms]()             | [uint32\_]()\_[t]() |
| [roll]()                       | [float]()      |
| [pitch]()                       | [float]()      |
| [yaw]()                       | [float]()      |
| [rollspeed]()                       | [float]()      |
| [pitchspeed]()                       | [float]()      |
| [Yawspeed]()                       | [float]()      |

### [2.5.8 ]()[航点任务协议]()

[请参考]()[https://mavlink.io/en/services/mission.html](https://mavlink.io/en/services/mission.html)
[最大航点数量60000。]()

| [报文ID\=]()\=[44]()<br />[MAVLINK\_]()\_[MSG\_]()\_[ID\_]()\_[MISSION\_]()\_[COUNT]() | [载荷长度: ]()<br />[MAVLINK2: 5，]()<br />[ MAVLINK1: 4 数据流向：双向]()  |
| ----------------------------- | ------- |
| [简写]()                            | [类型]()      |
| [count]()                            | [uint16\_]()\_[t]() |
| [target\_]()\_[system]()                       | [uint8\_]()\_[t]() |
| [target\_]()\_[component]()                       | [uint8\_]()\_[t]() |
| [mission\_]()\_[type]()                       | [uint8\_]()\_[t]() |

[注：黄色部分只有MAVLINK2才会发送。]()

| [报文ID\=]()\=[43]()<br />[MAVLINK\_]()\_[MSG\_]()\_[ID\_]()\_[MISSION\_]()\_[REQUEST\_]()\_[LIST]() | [载荷长度: ]()<br />[MAVLINK2: 3，]()<br />[ MAVLINK1: 2]()<br />[ 数据流向：双向]() |
| ---------------------------------- | -------- |
| [简写]()                                 | [类型]()       |
| [target\_]()\_[system]()                            | [uint8\_]()\_[t]()  |
| [target\_]()\_[component]()                            | [uint8\_]()\_[t]()  |
| [mission\_]()\_[type]()                            | [uint8\_]()\_[t]()  |

[注：黄色部分只有MAVLINK2才会发送。]()

| [报文ID\=]()\=[45]()<br />[MAVLINK\_]()\_[MSG\_]()\_[ID\_]()\_[MISSION\_]()\_[CLEAR\_]()\_[ALL]()<br />[ 清除所有任务]() | [载荷长度: ]()<br />[MAVLINK2: 3，]()<br />[ MAVLINK1: 2 数据流向：双向]()  |
| ------------------------------------ | ------- |
| [简写]()                                   | [类型]()      |
| [target\_]()\_[system]()                              | [uint8\_]()\_[t]() |
| [target\_]()\_[component]()                              | [uint8\_]()\_[t]() |
| [mission\_]()\_[type]()                              | [uint8\_]()\_[t]() |

[注：黄色部分只有MAVLINK2才会发送。]()

| [报文ID\=]()\=[51]()<br />[MAVLINK\_]()\_[MSG\_]()\_[ID\_]()\_[MISSION\_]()\_[REQUEST\_]()\_[INT]() | [载荷长度: ]()<br />[MAVLINK2: 5，]()<br />[ MAVLINK1: 4 数据流向：双向]()  |
| ---------------------------------- | ------- |
| [简写]()                                 | [类型]()      |
| [seq]()                                 | [uint16\_]()\_[t]() |
| [target\_]()\_[system]()                            | [uint8\_]()\_[t]() |
| [target\_]()\_[component]()                            | [uint8\_]()\_[t]() |
| [mission\_]()\_[type]()                            | [uint8\_]()\_[t]() |

[注：黄色部分只有MAVLINK2才会发送。]()

| [报文ID\=]()\=[47]()<br />[MAVLINK\_]()\_[MSG\_]()\_[ID\_]()\_[MISSION\_]()\_[ACK]() | [载荷长度: ]()<br />[MAVLINK2: 4，]()<br />[ MAVLINK1: 3 数据流向：双向]()  |
| ----------------------------- | ------- |
| [简写]()                            | [类型]()      |
| [target\_]()\_[system]()                       | [uint8\_]()\_[t]() |
| [target\_]()\_[component]()                       | [uint8\_]()\_[t]() |
| [type]()                            | [uint8\_]()\_[t]() |
| [mission\_]()\_[type]()                       | [uint8\_]()\_[t]() |

[注：黄色部分只有MAVLINK2才会发送。]()

| [报文ID\=]()\=[73]()<br />[MAVLINK\_]()\_[MSG\_]()\_[ID\_]()\_[MISSION\_]()\_[ITEM\_]()\_[INT]() | [载荷长度: 38，数据流向：双向]()      |
| ---------------------------------- | ------- |
| [简写]()                                 | [类型]()      |
| [param1]()                                 | [float]()      |
| [Param2]()                                 | [float]()      |
| [Param3]()                                 | [float]()      |
| [Param4]()                                 | [float]()      |
| [Param5]()                                 | [int32\_]()\_[t]() |
| [Param6]()                                 | [int32\_]()\_[t]() |
| [Param7]()                                 | [float]()      |
| [seq]()                                 | [uint16\_]()\_[t]() |
| [command]()                                 | [uint16\_]()\_[t]() |
| [target\_]()\_[system]()                            | [uint8\_]()\_[t]() |
| [target\_]()\_[component]()                            | [uint8\_]()\_[t]() |
| [frame]()                                 | [uint8\_]()\_[t]() |
| [current]()                                 | [uint8\_]()\_[t]() |
| [autocontinue]()                                 | [uint8\_]()\_[t]() |
| [mission\_]()\_[type]()                            | [uint8\_]()\_[t]() |

[注：黄色部分只有MAVLINK2才会发送。]()

[其中commad字段对应的param1-4参数定义如下：]()

| [commad字段]()        | [说明]()                                         |
| --------- | ------------------------------------------ |
| [command \=]()\=[ 16]()<br />[(航点)]() | [param1 \=]()\=[航点停留时间，单位秒 param2 \=]()\=[航点转弯半径，单位米， l 写0代表代表到点转弯， l &gt;]()\>[0代表协调转弯的半径(漂移过弯，不停留) param3 \=]()\=[ 0; param4 \=]()\=[飞机航向角，单位度，[0, 360]。 param5 \=]()\=[纬度，例：211234567 param6 \=]()\=[经度，例：1131234567 param7 \=]()\=[高度，单位米]() |
| [command \=]()\=[ 177]()<br />[(跳转航点/命令)]() | [param1 \=]()\=[航点/命令序号 param2 \=]()\=[重复次数。 param3 \=]()\=[ 0; param4 \=]()\=[ 0; param5 \=]()\=[ 0; param6 \=]()\=[ 0; param7 \=]()\=[ 0;]()      |
| [command \=]()\=[ 178]()<br />[(设置速度)]() | [param1 \=]()\=[速度类型 l 空速(0) (固定翼才用) l 地速(1) (一般设置这个) l 上升速度(2) param2 \=]()\=[速度，单位米/秒 param3 \=]()\=[ 0; param4 \=]()\=[ 0; param5 \=]()\=[ 0; param6 \=]()\=[ 0; param7 \=]()\=[ 0;]()      |
| [command \=]()\=[ 183]()<br />[(控制PWM通道)]() | [param1 \=]()\=[ PWM通道，[1 – 14] param2 \=]()\=[ PWM数值，[0 – 65000]。 param3 \=]()\=[ 0; param4 \=]()\=[ 0; param5 \=]()\=[ 0; param6 \=]()\=[ 0; param7 \=]()\=[ 0;]()      |

#### [2.5.8.1 上传任务航线]()

[图 2.3.7.1]()

[l  地面站先发送MISSION\_]()\_[COUNT(44)报文给无人机，其中包含即将发送的任务航点/命令的总个数N，告诉无人机准备接收N个任务报文。]()

[l  飞机收到MISSION\_]()\_[COUNT(44)报文后，开始发送MISSION\_]()\_[REQUEST\_]()\_[INT(51)报文请求给地面站，从0号任务航点/命令开始请求。]()

[l  地面站收到无人机发的MISSION\_]()\_[REQUEST\_]()\_[INT(51)报文请求后，开始发送MISSION\_]()\_[ITEM\_]()\_[INT(73)报文。]()

[l  无人机收到当前MISSION\_]()\_[ITEM\_]()\_[INT(73)报文后，继续发送MISSION\_]()\_[REQUEST\_]()\_[INT(51)报文来请求下一个航点/命令，直到接收完所有的N个任务报文。]()

[l  无人机收到所有N个任务报文后，发送MISSION\_]()\_[ACK(47)报文给地面站通知地面站已接收成功全部航点/命令。]()

#### [2.5.8.2 下载任务航线]()

[图 2.3.7.2]()

[l  地面站先发送MISSION\_]()\_[ REQUEST \_]()\_[LIST(43)报文给无人机，告诉无人机准备发送任务报文。无人机收到后会回复MISSION\_]()\_[COUNT(44)报文。]()

[l  地面站收到MISSION\_]()\_[COUNT(44)报文后，开始发送MISSION\_]()\_[REQUEST\_]()\_[INT(51)报文请求给地面站，从0号任务航点/命令开始请求。]()

[l  无人机收到地面站发的MISSION\_]()\_[REQUEST\_]()\_[INT(51)报文请求后，开始发送MISSION\_]()\_[ITEM\_]()\_[INT(73)报文。]()

[l  地面站收到当前MISSION\_]()\_[ITEM\_]()\_[INT(73)报文后，继续发送MISSION\_]()\_[REQUEST\_]()\_[INT(51)报文来请求下一个航点/命令，直到接收完所有的N个任务报文。]()

[l  地面站收到所有N个任务报文后，发送MISSION\_]()\_[ACK(47)报文给无人机通知无人机已接收成功全部航点/命令。]()

#### [2.5.8.3 任务执行流程]()

[当无人机在地面]()

[l  检查无人机的定位状态，确保GPS可用。]()

[l  上传航线到无人机。]()

[l  切换无人机模式到任务模式，然后发送解锁指令。]()

[当无人机在空中]()

[l  检查无人机的定位状态，确保GPS可用。]()

[l  上传航线到无人机。]()

[l  切换无人机模式到任务模式。]()

[暂停任务]()

[l  可切换飞行模式为定点模式]()

[l  使用摇杆(舵量不在中位)来夺取控制权]()

[继续执行任务]()

[l  切换回任务模式即可从断点处继续执行任务。]()

[l  重新上传航线再切换回任务模式，航线会重头开始执行。]()

# [3]()[地面站JSON协议]()

[地面站支持JSON格式上报无人机状态，但不支持JSON协议控制无人机]()

## [3.1  JSON]()[状态信息上报]()

[其中data字段的说明如下：]()

| [序号]() | [字段]() | [类型]()      | [单位]() | [备注]()                 |
| -- | -- | ------- | -- | ------------------ |
| [1]() | [RTKDAO]() | [double]()      | [度deg]() | [测向传感器角度0 – 360， 无效值：-1000]()                 |
| [2]() | [climbRate]() | [double]()      | [米/秒]() | [无人机上升速度]()                 |
| [3]() | [compass1Angle]() | [double]()      | [度deg]() | [罗盘1角度0 – 360， 无效值：-1000]()                 |
| [4]() | [Compass2Angle]() | [double]()      | [度deg]() | [罗盘2角度0 – 360， 无效值：-1000]()                 |
| [5]() | [Compass3Angle]() | [double]()      | [度deg]() | [罗盘3角度0 – 360， 无效值：-1000]()                 |
| [6]() | [current]() | [double]()      | [安A]() | [无人机总电流]()                 |
| [7]() | [device]() | [string]()      | [UTF-8]() | [默认 "vehicle"]()                 |
| [8]() | [elevation]() | [double]()      | [米]() | [无人机海拔高度]()                 |
| [9]() | [error]() | [string]()      | [UTF-8]() | [错误消息]()                 |
| [10]() | [flyDistance]() | [double]()      | [米]() | [无人机飞行距离]()                 |
| [11]() | [flyMode]() | [string]()      | [UTF-8]() | ["定点" "定高"]()<br />["任务"]()<br />["定点避障"]()<br />["返航"]()<br />["Offboard"]()<br />["跟踪"]()       |
| [12]() | [flyTime]() | [string]()      | [UTF-8]() | [无人机飞行时间，"00:00:00"]()                 |
| [13]() | [gps1Alt]() | [double]()      | [米]() | [RTK海拔高度]()                 |
| [14]() | [gps1Hdop]() | [double]()      | [米]() | [RTK水平定位精度]()                 |
| [15]() | [gps1Lat]() | [double]()      | [度]() | [RTK纬度坐标，例：21.1234567]()                 |
| [16]() | [gps1Lock]() | [string]()      | [UTF-8]() | [定位类型]()<br />["None",]()<br />["2D Lock",]()<br />["3D Lock",]()<br />["3D DGPS Lock",]()<br />["3D RTK GPS Lock (float) ",]()<br />["3D RTK GPS Lock (fixed) ",]()<br />["Static (fixed)"]()   |
| [17]() | [gps1Lon]() | [double]()      | [度]() | [RTK经度坐标，例：113.1234567]()                 |
| [18]() | [gps1Satellite]() | [int8\_]()\_[t]() | [颗]() | [RTK搜星数量]()                 |
| [19]() | [gps1Vdop]() | [double]()      | [米]() | [RTK垂直定位精度]()                 |
| [20]() | [gps2Alt]() | [double]()      | [米]() | [GPS海拔高度]()                 |
| [21]() | [gps2Hdop]() | [double]()      | [米]() | [GPS水平定位精度]()                 |
| [22]() | [gps2Lat]() | [double]()      | [度]() | [GPS纬度坐标，例：21.1234567]()                 |
| [23]() | [gps2Lock]() | [string]()      | [UTF-8]() | [定位类型]()<br />["None",]()<br />["2D Lock",]()<br />["3D Lock",]()<br />["3D DGPS Lock",]()<br />["3D RTK GPS Lock (float) ",]()<br />["3D RTK GPS Lock (fixed) ",]()<br />["Static (fixed)"]()   |
| [24]() | [gps2Lon]() | [double]()      | [度]() | [GPS经度坐标，例：113.1234567]()                 |
| [25]() | [gps2Satellite]() | [int8\_]()\_[t]() | [颗]() | [GPS搜星数量]()                 |
| [26]() | [gps2Vdop]() | [double]()      | [米]() | [GPS垂直定位精度]()                 |
| [27]() | [groundSpeed]() | [double]()      | [米/秒]() | [无人机水平速度]()                 |
| [28]() | [homeDistance]() | [double]()      | [米]() | [无人机距家距离]()                 |
| [29]() | [latitude]() | [double]()      | [度]() | [无人机纬度坐标，例：21.1234567]()                 |
| [30]() | [longitude]() | [double]()      | [度]() | [无人机经度坐标，例：113.1234567]()                 |
| [31]() | [pitch]() | [double]()      | [度]() | [无人机俯仰角度]()                 |
| [32]() | [pitchRate]() | [double]()      | [度/秒]() | [无人机俯仰角速度]()                 |
| [33]() | [relativeAlt]() | [double]()      | [米]() | [无人机相对高度]()                 |
| [34]() | [roll]() | [double]()      | [度]() | [无人机横滚角度]()                 |
| [35]() | [rollRate]() | [double]()      | [度/秒]() | [无人机横滚角速度]()                 |
| [36]() | [sdcardRemain]() | [double]()      | [GB]() | [无人机SD卡剩余容量]()                 |
| [37]() | [state]() | [string]()      | [UTF-8]() | [无人机状态]()<br />["flying"，飞行中]()<br />["armed"，解锁]()<br />["disarmed"，上锁]()           |
| [38]() | [uavSysID]() | [int]()      |  | [无人机ID]()                 |
| [39]() | [uavType]() | [string]()      | [UTF-8]() | [无人机机型]()<br />["四旋翼" "四旋翼+"]()<br />["六旋翼"]()<br />["六旋翼+"]()<br />["八旋翼"]()<br />["共轴双桨"]()<br />["三旋翼Y"]()<br />["四旋翼共轴双桨"]()<br />["直升机"]() |
| [40]() | [uavUUID]() | [string]()      | [UTF-8]() | [飞控序列号，无人机唯一识别码(出厂固定，不可更改)]()                 |
| [41]() | [voltage1]() | [double]()      | [伏]() | [无人机电压1]()                 |
| [42]() | [voltage2]() | [double]()      | [伏]() | [无人机电压2]()                 |
| [43]() | [yaw]() | [double]()      | [度]() | [无人机航向角]()                 |
| [44]() | [yawRate]() | [double]()      | [度/秒]() | [无人机航向角速度]()                 |
| [45]() | [timestampSinceEpoch]() | [uint64\_]()\_[t]() | [毫秒]() | [当前时间戳]()                 |
| [46]() | [timestampString]() | [string]()      |  | [格式: yyyy-MM-dd hh:mm:ss:zzz]()<br />[ 例子：2024-09-10 08:30:01:123]()               |