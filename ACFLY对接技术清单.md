# ACFLY地面站对接技术清单

**项目**: NexusHive适配ACFLY开源无人机  
**日期**: 2025-12-01  
**设备数量**: 3台无人机 + 1个地面站

---

## ✅ 已确认信息

### 1. 数据格式
- **地面站输出**: JSON格式(已提供样本)
- **数据结构**: 符合协议文档3.1节定义的46个字段
- **包装格式**: `{"command":"status", "data":{...}}`
- **设备唯一标识**: `uavUUID` (示例: "3600413430510633323435")
- **MAVLink系统ID**: `uavSysID` (示例中为1)

### 2. 协议文档
- ✅ 完整的MAVLink控制指令定义
- ✅ JSON状态上报字段说明
- ✅ 航点任务上传/下载流程
- ✅ 坐标系统定义

---

## ⚠️ 待甲方确认的关键信息

### 🔴 优先级1 - 网络架构(影响开发架构设计)

**问题1**: 地面站如何连接到云端服务器?
- [ ] A. 地面站主动连接云端(TCP/UDP Client模式)
- [ ] B. 云端主动连接地面站(TCP/UDP Server模式)  
- [ ] C. WebSocket连接
- [ ] D. HTTP轮询/长轮询
- [ ] E. MQTT Broker中转

**问题2**: 网络协议和端口?
- TCP端口: ___________
- UDP端口: ___________
- 如果是MQTT: Broker地址和端口?

**问题3**: 地面站部署位置?
- [ ] 现场有公网IP(可直接访问)
- [ ] 内网环境,需要frp/花生壳等内网穿透
- [ ] 4G/5G移动网络
- [ ] 企业专线网络

**问题4**: 地面站软件可配置性?
- [ ] 可以修改转发目标IP和端口
- [ ] 只能固定配置,需要网络层转发
- [ ] 支持配置多个目标地址(一对多推送)

---

### 🟡 优先级2 - 设备识别方案(影响数据库设计)

**问题5**: 3台无人机的uavSysID配置
- 无人机1: uavSysID = ____ (建议1)
- 无人机2: uavSysID = ____ (建议2)  
- 无人机3: uavSysID = ____ (建议3)

**问题6**: uavUUID是出厂固定还是可修改?
- [ ] 出厂固定(推荐,最可靠的唯一标识)
- [ ] 可通过地面站软件修改

**问题7**: 多无人机数据上报方式
- [ ] 地面站会合并3台无人机数据,一起推送
- [ ] 地面站为每台无人机建立独立连接
- [ ] 地面站轮流推送每台无人机数据

---

### 🟢 优先级3 - 控制指令发送(影响功能实现)

**问题8**: 如何向无人机发送控制指令?
- [ ] 通过地面站软件的网络接口转发MAVLink指令
- [ ] 直接连接飞控的网络端口(旁路控制)
- [ ] 只支持地面站界面手动操作,不支持远程API控制

**问题9**: 如果支持远程控制,接口格式是?
- [ ] 发送MAVLink二进制协议
- [ ] 发送JSON格式指令(需要具体格式示例)
- [ ] HTTP API接口(需要API文档)
- [ ] 其他: ___________

**问题10**: 控制指令的响应反馈机制?
- [ ] 有命令ACK反馈(COMMAND_ACK报文)
- [ ] 只能通过状态变化判断执行结果
- [ ] 地面站界面显示但不回传结果

---

### 🔵 优先级4 - 测试环境(影响开发调试)

**问题11**: 是否提供测试环境?
- [ ] 提供一套完整的地面站+无人机测试设备
- [ ] 只能在甲方现场调试
- [ ] 可以提供数据录像文件用于模拟

**问题12**: 测试时间安排
- 预计可提供测试设备的时间: ___________
- 测试地点: ___________
- 预计测试周期: ___________

---

## 📊 技术实现方案(基于不同答案)

### 方案A - 地面站主动推送(推荐)
**适用条件**: 地面站支持配置云端服务器地址  
**架构**: 地面站(TCP/UDP Client) → 云端服务器(TCP/UDP Server) → 数据库 → Web前端

```
优点: 实时性好,无需穿透内网
难点: 需要云端固定公网IP
开发周期: 8-10天
```

### 方案B - 云端主动拉取
**适用条件**: 地面站有公网IP或内网穿透  
**架构**: 云端定时轮询 → 地面站HTTP API → 解析数据 → 数据库

```
优点: 云端控制节奏
难点: 实时性差,需要内网穿透
开发周期: 10-12天
```

### 方案C - MQTT中转(最灵活)
**适用条件**: 地面站支持MQTT协议  
**架构**: 地面站 → EMQX Broker ← 云端服务 ← Web前端

```
优点: 解耦,支持多客户端订阅
难点: 需要配置MQTT Broker
开发周期: 12-15天
```

---

## 💰 报价调整建议

| 方案 | 技术难度 | 开发周期 | 建议报价 |
|------|---------|---------|---------|
| 方案A(主动推送) | ⭐⭐ | 8-10天 | ¥10,000 |
| 方案B(主动拉取) | ⭐⭐⭐ | 10-12天 | ¥12,000 |
| 方案C(MQTT中转) | ⭐⭐⭐⭐ | 12-15天 | ¥15,000 |

**额外费用项**:
- 如需内网穿透服务器: +¥800/年(frp服务器)
- 如需EMQX商业版: +¥3,000/年(自建免费但需维护)
- 如需现场调试差旅: +¥1,500/天

---

## 📋 下一步行动

**发给甲方的消息模板**:

```
您好,我已经收到ACFLY地面站协议文档和JSON数据样本。
为了准确评估项目可行性和开发周期,需要确认以下技术细节:

【核心问题-必须回答】
1. 地面站如何连接云端服务器?(主动推送/被动拉取/MQTT)
2. 使用的网络协议和端口号?
3. 地面站是否可以配置云端服务器地址?
4. 3台无人机的MAVLink系统ID分别是多少?(建议设置为1,2,3)

【次要问题-建议回答】
5. 是否需要云端远程控制无人机?(起飞/降落/返航等)
6. 能否提供测试设备和时间安排?

根据您的答案,我会给出准确的技术方案和最终报价(¥10,000-15,000)。
```

---

## 🎯 项目接受建议

**建议接受条件**:
- ✅ 地面站支持配置云端地址(方案A)
- ✅ 甲方提供测试环境
- ✅ 只需数据上报+简单控制
- ✅ 报价≥¥10,000

**建议拒绝条件**:
- ❌ 需要复杂的企业内网穿透
- ❌ 要求实时视频流传输
- ❌ 不提供测试环境且要求现场调试
- ❌ 预算<¥10,000
